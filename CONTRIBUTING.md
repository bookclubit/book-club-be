# Руководство по вкладу

Спасибо за интерес к проекту! Ниже описаны основные правила и рекомендации для разработки, запуска и добавления новых изменений.

## Переменные окружения и валидация

В проекте настроена runtime‑валидация переменных окружения с помощью Zod.  
При запуске приложения происходит проверка `.env`, и при ошибке приложение **не стартует**, а в консоли выводится сообщение о ней.

Схемы валидации находятся в:

- `src/common/validators/env.dev.ts` — схема для окружения `development`.
- `src/common/validators/env.prod.ts` — схема для окружения `production`.
- `src/common/validators/env.validate.ts` — выбор нужной схемы и форматирование ошибок.

В `AppModule` валидация подключена через:

```js
ConfigModule.forRoot({
  isGlobal: true,
  validate: validateEnv,
});
```

### Обязательные переменные для development

Файл: `.env`

```
TELEGRAM_BOT_TOKEN=...
DATABASE_URL=
NODE_ENV=development
PORT=
```

Если какая‑то переменная отсутствует или имеет неверный формат, приложение упадёт с ошибкой вида:

```bash
Ошибка валидации переменных окружения:
- PORT: PORT обязателен и должен быть строкой
```

### Обязательные переменные для production

Файл: `.env.prod` (или переменные окружения на сервере/в контейнере):

```
TELEGRAM_BOT_TOKEN=...
DATABASE_URL=
POSTGRES_USER=
POSTGRES_PASSWORD=
POSTGRES_DB=
NODE_ENV=production
PORT=
```

Все перечисленные переменные валидируются Zod‑схемой для production.  
При отсутствии/некорректном значении приложение также не стартует.

## Добавление/изменение переменных окружения

Если вы:

- добавляете новую переменную,
- меняете формат существующей,

то **обязательно**:

1. Обновите соответствующую Zod‑схему:

- `env.dev.ts` для dev,
- `env.prod.ts` для prod.

2. Обновите пример `.env` / `.env.prod` в этом файле и/или в `README.md`.
3. Убедитесь, что при неправильном значении переменной приложение падает с понятной ошибкой.
