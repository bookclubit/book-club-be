# Руководство по вкладу

Спасибо за интерес к проекту! Ниже описаны основные правила и рекомендации для разработки, запуска и добавления новых изменений.

## Переменные окружения и валидация

В проекте настроена runtime‑валидация переменных окружения с помощью Zod.  
При запуске приложения происходит проверка `.env`, и при ошибке приложение **не стартует**, а в консоли выводится сообщение о ней.

Схемы валидации находятся в:

- `src/app/validators/env.schema.ts` — единая схема конфигурации (`envSchema`).
- `src/app/validators/env.validation.ts` — функция `validateEnv`, которая выполняет проверку и форматирует ошибки.

В `AppModule` валидация подключена через:

```js
ConfigModule.forRoot({
  isGlobal: true,
  validate: validateEnv,
});
```

### Обязательные переменные окружения

Для приложения используется **один** `.env` (и один `.env.example`).

```
--- App Configuration ---
PORT=3000

--- Telegram bot ---
TELEGRAM_BOT_TOKEN=...

--- Database (shared/prod/docker) ---
POSTGRES_USER=myuser
POSTGRES_PASSWORD=mypassword
POSTGRES_DB=bookclubdb

--- Database URL (только для локального запуска) ---
DATABASE_URL=postgresql://myuser:mypassword@localhost:5432/bookclubdb
```

Если какая‑то переменная отсутствует или имеет неверный формат, приложение упадёт с ошибкой вида:

```bash
Ошибка валидации переменных окружения:
- PORT: PORT обязателен и должен быть строкой
```

### Добавление/изменение переменных окружения

Если вы:

- добавляете новую переменную;
- меняете формат существующей (тип, обязательность и т.п.),

то **обязательно**:

1. Обновите Zod‑схему в `src/app/validators/env.schema.ts`:
   - добавьте новое поле в `envSchema`;
   - при необходимости задайте человекочитаемые русские сообщения (`.min(...)`, `.int(...)` и т.д.).
2. Обновите пример `.env.example` и при необходимости этот файл (`CONTRIBUTING.md` или `README.md`).
3. Проверьте, что при отсутствии/невалидном значении переменной:
   - приложение не стартует;
   - в консоли выводится понятное сообщение об ошибке, из которого ясно, какую переменную нужно исправить.

Так мы поддерживаем единый контракт конфигурации и защищаем приложение от «тихих» ошибок в настройках окружения.

## Семантические комментарии в коде

Для поддержания качества и удобства сопровождения кода используем систему тегированных комментариев. Она помогает быстро находить важные места и задачи с помощью инструментов, например, TODO Tree.

Подробнее о тегах и правилах их использования читай в [docs/comment-tags.md](docs/comment-tags.md).

Основные теги:

- `// INFO` — пояснительная информация, без задач.
- `// TODO #номер_задачи` — незавершённая задача с ссылкой на тикет.
- `// HACK #номер_задачи` — временное решение, костыль с описанием.
- `// IMPORTANT` — особо важное, критичное место.

Формат и требования к комментариям указаны в подробностях в docs/comment-tags.md.

Просим строго придерживаться данных правил, чтобы сохранить порядок и качество кода.

